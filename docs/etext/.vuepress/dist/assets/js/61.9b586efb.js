(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{490:function(t,e,a){"use strict";a.r(e);var n=a(23),o=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"frontmatter-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[t._v("#")]),t._v(" "+t._s(t.$frontmatter.title))]),t._v(" "),a("p",[t._v(t._s(t.$frontmatter.description))]),t._v(" "),a("KeyConcepts",{attrs:{ConceptArray:[{Concept:"TRAP Routines are Built-In",Details:"Code for all TRAP routines are loaded into the Simulate environment each time it is started or reinitilaized"},{Concept:"LC-3 uses Vercor/Jump Table for calling TRAP code",Details:"The address (i.e. TRAP x22) is the address int the Vector/Jump Table"},{Concept:"The Vector/Jump table contains code addresses",Details:"Each Vector/Jump tablr address contains the address of the start of the associated TRAP routine code"}]}}),t._v(" "),a("h2",{attrs:{id:"introduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),a("p",[t._v("The LC-3 provides a few built-in functions to make the system easier to use. These are common routines that typical programs might use, and is provided so a programmer does not need to write their own code")]),t._v(" "),a("p",[t._v("LC-3 provides 2 User Input and 3 User Output TRAP routines, as well as the HALT routine to terminate execution")]),t._v(" "),a("h2",{attrs:{id:"lc-3-trap-routines"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lc-3-trap-routines"}},[t._v("#")]),t._v(" LC-3 TRAP Routines")]),t._v(" "),a("p",[t._v("The LC-3, designed as a teaching ISA, includes TRAP functions to support general keyboard input and terminal output")]),t._v(" "),a("LC3Instruction",{attrs:{opName:"TRAP",bitPattern:{OpCode:"1111",unused:"0000",trapvect8:"--------"},descriptions:[{OPCode:"Bits [15:12]"},{unused:""},{trapvect8:"8-bit address of Trap Vector"}],examples:["TRAP x23 ; Call IN trap routine","IN ; Call IN trap routine"]}}),t._v(" "),a("p",[t._v("Calling these routines in user code can take 1 of 2 different forms:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  ; These two lines call the same TRAP code\n  TRAP x20  ; Get character from console\n  GETC      ; Uses assembler shortcut for TRAP x20\n")])])]),a("p",[t._v("Note that the address in the 1st example is the TRAP Vector, not the Code Address. This is because LC-3 uses a Vector or Jump Table to look up the address of the first line of the actual TRAP code")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("TRAP Vector")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Code Address")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Assembler Shortcut")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Purpose")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Result")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0020")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("x0400")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("GETC")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Read one input character from the keyboard and store it into R0 "),a("em",[t._v("without echoing the character to the console")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("After execution, R0 contains the ascii code for the character entered in the console")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0021")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("x0430")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("OUT")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Output character to the console")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Before execution, load R0 with ascii code to display in console")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0022")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("x0450")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("PUTS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Output null terminating string to the console")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Load address (using LEA) of first charater of the string to display")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0023")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("x04A0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("IN")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Displays a prompt and reads one input character from the keyboard and store it into R0 "),a("em",[t._v("and echo the character to the console")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("After execution, R0 contains the ascii code for the character entered in the console")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0024")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("x04E0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("PUTSP")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Same as PUTS except that it outputs null terminated strings with two ASCII characters packed into a single memory location, with the low 8 bits outputted first then the high 8 bits")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Load address (using LEA) of first charater of the string to display")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("x0025")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("xFD70")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("HALT")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Ends a userâ€™s program")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("None. But does modifiy registes while execting and does not return")])])])]),t._v(" "),a("h2",{attrs:{id:"review-trap-code-in-lc-3-simulate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#review-trap-code-in-lc-3-simulate"}},[t._v("#")]),t._v(" Review TRAP Code in LC-3 Simulate")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("You Do It - Find and Review GETC TRAP Code")]),t._v(" "),a("ol",[a("li",[t._v("Start the LC-3 Simulate environment. Don't load an code, just use the system are it starts up")]),t._v(" "),a("li",[t._v("Enter x0020 in Jump to box and press enter")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/02_AssemblyProgramming/TRAP_JumpTox20.png",alt:"Jump to X0020"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Note the value in x0020 It should be x0400")]),t._v(" "),a("li",[t._v("Enter x0400 in Jump to box and press enter")])]),t._v(" "),a("p",[t._v("x0400 is the first line of the GETC TRAP routine")])]),t._v(" "),a("QuestionMC",{attrs:{question:"What register(s) are save at the start of GETC at x0400?",answer:"B",AChoice:"None",BChoice:"R7",CChoice:"R7 and R0",DChoice:"R0",rightAnswerFeedback:"CWe will learn the importance of R7 in TRAP and Subroutines soon",wrongAnswerFeedback:"The first line, ST R7, x0408, is the only register saves in GETC"}}),t._v(" "),a("QuestionMC",{attrs:{question:"What is the last action GETC performs before the RET line at x0404?",answer:"D",AChoice:"Converts the character to ASCII",BChoice:"Displays the charater",CChoice:"Loads R7 into x0408",DChoice:"Restores R7",rightAnswerFeedback:"We will learn why soon",wrongAnswerFeedback:"The last line fore RET is a LD call, restoring R7 with the value it contained when GETC started"}}),t._v(" "),a("QuestionTF",{attrs:{question:"The 2 TRAP instructions that appear at x0406 and x0407 are real TRAP instruction calls",answer:"false",rightAnswerFeedback:"Simulate will always try to identify an LC-3 instruction, even if the memory location contains 16 bits of data",wrongAnswerFeedback:"Simulate will always try to identify an LC-3 instruction, even if the memory location contains 16 bits of data. In this case, the RET at x0405 indicates the TRAP code ender here. These 2 memory locations contain data declarations GETC allocated to use while executing"}}),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TRAP Routines in other Instruction Architecture Sets")]),t._v(" "),a("p",[t._v("TRAP routines are ISA-defined. Each ISA may provide routines to support the intended/expected use of the ISA. An ISA designed for communication might include TRAP functions to connect to external systems and support basic I/O functions")])]),t._v(" "),a("h2",{attrs:{id:"trap-vector-table"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trap-vector-table"}},[t._v("#")]),t._v(" Trap Vector Table")]),t._v(" "),a("p",[t._v("The LC-3 reserves memory addresses x0000 - x00FF for TRAP routine lookup. The TRAP Vector Table only contains references in memory locations x0020 - x0025 for the existing 6 routines. Each address in this jump table contains the location, in memory, of the start of a given TRAP function code block")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Vector Table Location")]),t._v(" "),a("p",[t._v("LC-3 allocated memory location x0000 - x00FF for Trap Vector entries. This sets aside 256 memory location for addresses to TRAP routines. However, LC-3 only provides 6 TRAP routines, so much of the Vector Table is empty")])]),t._v(" "),a("QuestionTF",{attrs:{question:"If the LC-3 creators wanted to move PUTS from x0450 to x0460, they would only need to change the LC-3 Trap Vector Table's Vector for PUTS?",answer:"true",rightAnswerFeedback:"That is the main advantage to Vector Tables...it is easy to relocate the code and update the Vector Table",wrongAnswerFeedback:"The Vector Table serves as an address book for TRAP Routines. TRAP x22 will run whatever code is at the Vector entry for x0022"}}),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("How the LC-3 Executes a TRAP PUTS instruction")]),t._v(" "),a("p",[t._v("During the execution the "),a("code",[t._v("TRAP PUTS")]),t._v(" instruction, the LC-3 controller 'knows' the PUTS vector entry in the table is memory location x0022. The controller requested the contents of memory location x0022, and receives the address x0450")]),t._v(" "),a("p",[t._v("The controller stores the current PC (instruciton after the "),a("code",[t._v("TRAP PUTS")]),t._v(" instruction) in R7, and changes the PC to x0450. It then ends the instruction cycle")]),t._v(" "),a("p",[t._v("The next instruction cycle starts with the PC x0450, and the first line of the PUTS instruction begines a new instruction cycle")])]),t._v(" "),a("p",[t._v("Things to note:")]),t._v(" "),a("ul",[a("li",[t._v("The Jump Table address (x0022) for PUTS contains the address (x0450) of the first line of code for the "),a("code",[t._v("PUTS TRAP")]),t._v(" function")]),t._v(" "),a("li",[t._v("Before the PC is changed to x0450, the LC-3 controller stashed the current PC in R7\n"),a("ul",[a("li",[t._v("Remember that R7 is used by "),a("code",[t._v("RET")]),t._v(" to return back to the")])])])]),t._v(" "),a("h3",{attrs:{id:"the-puts-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-puts-function"}},[t._v("#")]),t._v(" The PUTS Function")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".ORIG x0450\n\t;;; Save Registers ;;;\nSavRegs\tST R7, R7_Store ; Return Address\n\t\tST R0, R0_Store ; Pointer to String to Puts\n\t\tST R1, R1_Store\n\t\tST R2, R2_Store\n\nLoop\tLDR R1, R0, #0; Get address of first char of string\n\t\tBRz Done ;\tChar was 0, so we are done\n\nWait\tLDI R2, DSR ;\tConsole available?\n\t\tBRzp Wait \t;\tNo, loop back and try again\n\n\t\tSTI R1, DDR ;\tWrite char to console\n\n\t\tADD R0, R0, #1;\tMove pointer to next char in String\n\t\tBRnzp Loop ;\tLoop back for next caracter\n\n\t;;; Restore Registers ;;;\nDone\tLD R0, R0_Store\n\t\tLD R1, R1_Store\n\t\tLD R2, R2_Store\n\t\tLD R7, R7_Store\n\n\t\tRET\n\n;Data Declarations-------------\n\tDSR\t\t.FILL xFE04\n\tDDR\t\t.FILL xFE06\n\tMX0462\t\t.FILL xF3FD\n\tMX0463\t\t.FILL xF3FE\n\tR0_Store\t.FILL #0\n\tR1_Store\t.FILL #0\n\tR2_Store\t.FILL #0\n\tR7_Store\t.FILL #0\n.END\n")])])]),a("p",[t._v("Things to note:")]),t._v(" "),a("ol",[a("li",[t._v("PUTS first stores the current contents of R7, R0, R1, R2 in memory\n"),a("ul",[a("li",[t._v("R7 contains the location of the calling code's next instruction")]),t._v(" "),a("li",[t._v("R0 was set in the calling code just before calling PUTS. It contains the address of the first character to be output by PUTS\n"),a("ul",[a("li",[t._v("PUTS stores R0 at the start because it will change R0 as it prints each character")]),t._v(" "),a("li",[t._v("The calling code may expect R0 to be set like it was before it called PUTS")])])]),t._v(" "),a("li",[t._v("R1 and R2 are used in the execution of PUTS. Because PUTS has no way of knowing if the calling code was using these registers, it stores them to be safe")])])]),t._v(" "),a("li",[t._v("Next PUTS gets the first character, stored in R0 by the calling code\n"),a("ul",[a("li",[t._v("At any time R0 contains zero (0), PUTS will exit this loop as all characters have been written to the console")]),t._v(" "),a("li",[t._v("a value zero (0) is a special case to PUTS. It is the end-of-string marker")])])]),t._v(" "),a("li",[t._v("Expecting that R0 does not contain zero (0), PUTS waits for the console to be ready, then copies the value in R0 (an ascii number representing the character to display) to the Display Data Register")]),t._v(" "),a("li",[t._v("R0 is incremented to point to the next character in the string to display")]),t._v(" "),a("li",[t._v("PUTS unconditionally loop back to check for zero (0), and start the cycle again")]),t._v(" "),a("li",[t._v("Once R0 is loaded with zero (0), PUTS is done displaying characters\n"),a("ul",[a("li",[t._v("R7, R0, R1, and R2 original values are copied from memory back to each register")])])]),t._v(" "),a("li",[t._v("RET is called, and the PC is loaded with the value n R7 (the calling code's next instruction)")]),t._v(" "),a("li",[t._v("Execution continues ate the calling code's next instruction after PUTS was called")])]),t._v(" "),a("h2",{attrs:{id:"conclusion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[t._v("#")]),t._v(" Conclusion")]),t._v(" "),a("p",[t._v("TRAP Routines are defined by an ISA")]),t._v(" "),a("p",[t._v("Designers and implementers of an ISA write TRAP code and provide information in the ISA's Application Programming Iinterface (API) to help assembly programs find and use these utilities")]),t._v(" "),a("p",[t._v("LC-3 designers provide 6 TRAP routines")]),t._v(" "),a("p",[t._v("LC-3 TRAP routines can be called using the "),a("code",[t._v("TRAP")]),t._v(" instruction")]),t._v(" "),a("p",[t._v("LC-3 Assembler can also identify special shorcut names for TRAP routines, to make code more understandable")]),t._v(" "),a("p",[t._v("Like subroutines, TRAP routines save registers when they start and restore them when complete")]),t._v(" "),a("blockquote",[a("p",[t._v("If they did not save registers they use, the registers would be in an unpredictable state when a TRAP returns back to your program...making it virtually unusable")])]),t._v(" "),a("p",[t._v("Also, like subroutines, "),a("code",[t._v("TRAP")]),t._v(" routines use "),a("code",[t._v("RET")]),t._v(" to return control back to the program that")]),t._v(" "),a("p",[t._v("TRAP routines may require particular register be set before calling -or- set during execution for the user program to examine after the TRAP completes")])],1)}),[],!1,null,null,null);e.default=o.exports}}]);