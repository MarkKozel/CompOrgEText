<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TRAP Routines | CS 131 - Computer Organization</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Built-in code for common operation">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.cae50936.css" as="style"><link rel="preload" href="/assets/js/app.55f9c1c1.js" as="script"><link rel="preload" href="/assets/js/2.23fe0875.js" as="script"><link rel="preload" href="/assets/js/61.9b586efb.js" as="script"><link rel="preload" href="/assets/js/5.f5b36fc3.js" as="script"><link rel="preload" href="/assets/js/3.799b0ae7.js" as="script"><link rel="preload" href="/assets/js/6.316a9004.js" as="script"><link rel="preload" href="/assets/js/7.9b806e34.js" as="script"><link rel="prefetch" href="/assets/js/10.5bd32d4f.js"><link rel="prefetch" href="/assets/js/11.a829b5f9.js"><link rel="prefetch" href="/assets/js/12.7308925a.js"><link rel="prefetch" href="/assets/js/13.a6068e34.js"><link rel="prefetch" href="/assets/js/14.4d64f870.js"><link rel="prefetch" href="/assets/js/15.6f8be927.js"><link rel="prefetch" href="/assets/js/16.b35aa036.js"><link rel="prefetch" href="/assets/js/17.5d5c29d8.js"><link rel="prefetch" href="/assets/js/18.29b1bbdd.js"><link rel="prefetch" href="/assets/js/19.fb8b109d.js"><link rel="prefetch" href="/assets/js/20.6a93413b.js"><link rel="prefetch" href="/assets/js/21.38653396.js"><link rel="prefetch" href="/assets/js/22.ce0d711f.js"><link rel="prefetch" href="/assets/js/23.ef090e13.js"><link rel="prefetch" href="/assets/js/24.e3d5246b.js"><link rel="prefetch" href="/assets/js/25.76357b1a.js"><link rel="prefetch" href="/assets/js/26.d29a0ca5.js"><link rel="prefetch" href="/assets/js/27.a18b74d2.js"><link rel="prefetch" href="/assets/js/28.a80cbb66.js"><link rel="prefetch" href="/assets/js/29.aa187075.js"><link rel="prefetch" href="/assets/js/30.cc45cc20.js"><link rel="prefetch" href="/assets/js/31.527f073f.js"><link rel="prefetch" href="/assets/js/32.ec7dccd4.js"><link rel="prefetch" href="/assets/js/33.8aaeb412.js"><link rel="prefetch" href="/assets/js/34.def8ebe7.js"><link rel="prefetch" href="/assets/js/35.9565748e.js"><link rel="prefetch" href="/assets/js/36.1a7d8c71.js"><link rel="prefetch" href="/assets/js/37.540f1705.js"><link rel="prefetch" href="/assets/js/38.d11a2905.js"><link rel="prefetch" href="/assets/js/39.cd120c63.js"><link rel="prefetch" href="/assets/js/4.9b335f76.js"><link rel="prefetch" href="/assets/js/40.fbad6832.js"><link rel="prefetch" href="/assets/js/41.3f63dcaf.js"><link rel="prefetch" href="/assets/js/42.631e9065.js"><link rel="prefetch" href="/assets/js/43.fdc7fc56.js"><link rel="prefetch" href="/assets/js/44.62ee35b0.js"><link rel="prefetch" href="/assets/js/45.53220787.js"><link rel="prefetch" href="/assets/js/46.d56d5c68.js"><link rel="prefetch" href="/assets/js/47.96782874.js"><link rel="prefetch" href="/assets/js/48.8e3c02f0.js"><link rel="prefetch" href="/assets/js/49.a96cf87b.js"><link rel="prefetch" href="/assets/js/50.2843ced3.js"><link rel="prefetch" href="/assets/js/51.332d1218.js"><link rel="prefetch" href="/assets/js/52.73dc97c1.js"><link rel="prefetch" href="/assets/js/53.ba44c0d0.js"><link rel="prefetch" href="/assets/js/54.07834be9.js"><link rel="prefetch" href="/assets/js/55.894d16a1.js"><link rel="prefetch" href="/assets/js/56.ceecc893.js"><link rel="prefetch" href="/assets/js/57.70cc71eb.js"><link rel="prefetch" href="/assets/js/58.b7a964f3.js"><link rel="prefetch" href="/assets/js/59.01d8fa5a.js"><link rel="prefetch" href="/assets/js/60.11a0716f.js"><link rel="prefetch" href="/assets/js/62.826d95d9.js"><link rel="prefetch" href="/assets/js/63.cb80a864.js"><link rel="prefetch" href="/assets/js/64.159fec77.js"><link rel="prefetch" href="/assets/js/65.054924e7.js"><link rel="prefetch" href="/assets/js/66.74a29ade.js"><link rel="prefetch" href="/assets/js/67.0c6949a4.js"><link rel="prefetch" href="/assets/js/68.6c20ed63.js"><link rel="prefetch" href="/assets/js/69.4e4578cc.js"><link rel="prefetch" href="/assets/js/70.407cd69d.js"><link rel="prefetch" href="/assets/js/71.8439dfbb.js"><link rel="prefetch" href="/assets/js/72.b6273b33.js"><link rel="prefetch" href="/assets/js/73.6eb60eae.js"><link rel="prefetch" href="/assets/js/74.131ad3af.js"><link rel="prefetch" href="/assets/js/75.735a0cf8.js"><link rel="prefetch" href="/assets/js/8.1e607f02.js"><link rel="prefetch" href="/assets/js/9.e8afeaed.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cae50936.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/CourseLogo.png" alt="CS 131 - Computer Organization" class="logo"> <span class="site-name can-hide">CS 131 - Computer Organization</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/etext/" class="nav-link">
  E-Text
</a></div><div class="nav-item"><a href="/LC3/" class="nav-link router-link-active">
  LC3
</a></div><div class="nav-item"><a href="/CourseInformation/" class="nav-link">
  Course Info
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  VP Guide
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/etext/" class="nav-link">
  E-Text
</a></div><div class="nav-item"><a href="/LC3/" class="nav-link router-link-active">
  LC3
</a></div><div class="nav-item"><a href="/CourseInformation/" class="nav-link">
  Course Info
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  VP Guide
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/LC3/" class="sidebar-heading clickable router-link-active"><span>The LC3</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/LC3/" aria-current="page" class="sidebar-link">LC3 Assembly Emulator</a></li><li><a href="/LC3/GettingStarted.html" class="sidebar-link">Getting Started with the LC-3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/LC3/Commands/" class="sidebar-heading clickable router-link-active open"><span>LC3 Commands</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/LC3/Commands/" aria-current="page" class="sidebar-link">LC3 Commands</a></li><li><a href="/LC3/Commands/ALU.html" class="sidebar-link">LC3 ALU Commands</a></li><li><a href="/LC3/Commands/Branching.html" class="sidebar-link">LC3 Branching Commands</a></li><li><a href="/LC3/Commands/MemoryAccess.html" class="sidebar-link">LC3 Memory Access Commands</a></li><li><a href="/LC3/Commands/TrapRoutines.html" aria-current="page" class="active sidebar-link">TRAP Routines</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/LC3/Commands/TrapRoutines.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/LC3/Commands/TrapRoutines.html#lc-3-trap-routines" class="sidebar-link">LC-3 TRAP Routines</a></li><li class="sidebar-sub-header"><a href="/LC3/Commands/TrapRoutines.html#review-trap-code-in-lc-3-simulate" class="sidebar-link">Review TRAP Code in LC-3 Simulate</a></li><li class="sidebar-sub-header"><a href="/LC3/Commands/TrapRoutines.html#trap-vector-table" class="sidebar-link">Trap Vector Table</a></li><li class="sidebar-sub-header"><a href="/LC3/Commands/TrapRoutines.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li><li><a href="/LC3/Commands/Subroutine.html" class="sidebar-link">LC3 Subroutine Commands</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> TRAP Routines</h1> <p>Built-in code for common operation</p> <div class="key-concepts" data-v-6393cc7e><table style="border:none" data-v-6393cc7e><tr data-v-6393cc7e><td class="border" style="10%" data-v-6393cc7e><p class="header" data-v-6393cc7e>Key Concepts</p></td> <table cellspacing="0" cellpadding="0" class="inner" data-v-6393cc7e><tr class="inner" data-v-6393cc7e><td class="inner" data-v-6393cc7e><p id="TRAP Routines are Built-In" class="concept" data-v-6393cc7e>TRAP Routines are Built-In</p></td> <td class="inner" data-v-6393cc7e><p id="TRAP Routines are Built-In" class="details" data-v-6393cc7e>Code for all TRAP routines are loaded into the Simulate environment each time it is started or reinitilaized</p></td></tr><tr class="inner" data-v-6393cc7e><td class="inner" data-v-6393cc7e><p id="LC-3 uses Vercor/Jump Table for calling TRAP code" class="concept" data-v-6393cc7e>LC-3 uses Vercor/Jump Table for calling TRAP code</p></td> <td class="inner" data-v-6393cc7e><p id="LC-3 uses Vercor/Jump Table for calling TRAP code" class="details" data-v-6393cc7e>The address (i.e. TRAP x22) is the address int the Vector/Jump Table</p></td></tr><tr class="inner" data-v-6393cc7e><td class="inner" data-v-6393cc7e><p id="The Vector/Jump table contains code addresses" class="concept" data-v-6393cc7e>The Vector/Jump table contains code addresses</p></td> <td class="inner" data-v-6393cc7e><p id="The Vector/Jump table contains code addresses" class="details" data-v-6393cc7e>Each Vector/Jump tablr address contains the address of the start of the associated TRAP routine code</p></td></tr></table></tr></table></div> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>The LC-3 provides a few built-in functions to make the system easier to use. These are common routines that typical programs might use, and is provided so a programmer does not need to write their own code</p> <p>LC-3 provides 2 User Input and 3 User Output TRAP routines, as well as the HALT routine to terminate execution</p> <h2 id="lc-3-trap-routines"><a href="#lc-3-trap-routines" class="header-anchor">#</a> LC-3 TRAP Routines</h2> <p>The LC-3, designed as a teaching ISA, includes TRAP functions to support general keyboard input and terminal output</p> <div class="lc3instruction" data-v-378e5ead><table class="outer" style="width: 100%" data-v-378e5ead><h3 class="title" data-v-378e5ead>TRAP</h3> <table class="inner" data-v-378e5ead><thead data-v-378e5ead><tr data-v-378e5ead><th style="text-align: center" data-v-378e5ead>
            OpCode
          </th><th style="text-align: center" data-v-378e5ead>
            unused
          </th><th style="text-align: center" data-v-378e5ead>
            trapvect8
          </th></tr></thead> <tbody data-v-378e5ead><td style="text-align: center" data-v-378e5ead>
          1111
        </td><td style="text-align: center" data-v-378e5ead>
          0000
        </td><td style="text-align: center" data-v-378e5ead>
          --------
        </td></tbody></table> <p class="close" data-v-378e5ead><b data-v-378e5ead>OPCode</b> : Bits [15:12]
    </p><p class="close" data-v-378e5ead><b data-v-378e5ead>unused</b> : 
    </p><p class="close" data-v-378e5ead><b data-v-378e5ead>trapvect8</b> : 8-bit address of Trap Vector
    </p> <div class="close" data-v-378e5ead><br data-v-378e5ead> <!----> <p class="operation" data-v-378e5ead></p> <p class="example" data-v-378e5ead>Examples:</p> <p class="close code" data-v-378e5ead>
        TRAP x23 ; Call IN trap routine
      </p><p class="close code" data-v-378e5ead>
        IN ; Call IN trap routine
      </p></div></table></div> <p>Calling these routines in user code can take 1 of 2 different forms:</p> <div class="language- extra-class"><pre class="language-text"><code>  ; These two lines call the same TRAP code
  TRAP x20  ; Get character from console
  GETC      ; Uses assembler shortcut for TRAP x20
</code></pre></div><p>Note that the address in the 1st example is the TRAP Vector, not the Code Address. This is because LC-3 uses a Vector or Jump Table to look up the address of the first line of the actual TRAP code</p> <table><thead><tr><th style="text-align:center;">TRAP Vector</th> <th style="text-align:center;">Code Address</th> <th style="text-align:center;">Assembler Shortcut</th> <th style="text-align:left;">Purpose</th> <th style="text-align:left;">Result</th></tr></thead> <tbody><tr><td style="text-align:center;">x0020</td> <td style="text-align:center;">x0400</td> <td style="text-align:center;">GETC</td> <td style="text-align:left;">Read one input character from the keyboard and store it into R0 <em>without echoing the character to the console</em></td> <td style="text-align:left;">After execution, R0 contains the ascii code for the character entered in the console</td></tr> <tr><td style="text-align:center;">x0021</td> <td style="text-align:center;">x0430</td> <td style="text-align:center;">OUT</td> <td style="text-align:left;">Output character to the console</td> <td style="text-align:left;">Before execution, load R0 with ascii code to display in console</td></tr> <tr><td style="text-align:center;">x0022</td> <td style="text-align:center;">x0450</td> <td style="text-align:center;">PUTS</td> <td style="text-align:left;">Output null terminating string to the console</td> <td style="text-align:left;">Load address (using LEA) of first charater of the string to display</td></tr> <tr><td style="text-align:center;">x0023</td> <td style="text-align:center;">x04A0</td> <td style="text-align:center;">IN</td> <td style="text-align:left;">Displays a prompt and reads one input character from the keyboard and store it into R0 <em>and echo the character to the console</em></td> <td style="text-align:left;">After execution, R0 contains the ascii code for the character entered in the console</td></tr> <tr><td style="text-align:center;">x0024</td> <td style="text-align:center;">x04E0</td> <td style="text-align:center;">PUTSP</td> <td style="text-align:left;">Same as PUTS except that it outputs null terminated strings with two ASCII characters packed into a single memory location, with the low 8 bits outputted first then the high 8 bits</td> <td style="text-align:left;">Load address (using LEA) of first charater of the string to display</td></tr> <tr><td style="text-align:center;">x0025</td> <td style="text-align:center;">xFD70</td> <td style="text-align:center;">HALT</td> <td style="text-align:left;">Ends a user’s program</td> <td style="text-align:left;">None. But does modifiy registes while execting and does not return</td></tr></tbody></table> <h2 id="review-trap-code-in-lc-3-simulate"><a href="#review-trap-code-in-lc-3-simulate" class="header-anchor">#</a> Review TRAP Code in LC-3 Simulate</h2> <div class="custom-block tip"><p class="custom-block-title">You Do It - Find and Review GETC TRAP Code</p> <ol><li>Start the LC-3 Simulate environment. Don't load an code, just use the system are it starts up</li> <li>Enter x0020 in Jump to box and press enter</li></ol> <p><img src="/assets/img/02_AssemblyProgramming/TRAP_JumpTox20.png" alt="Jump to X0020"></p> <ol start="3"><li>Note the value in x0020 It should be x0400</li> <li>Enter x0400 in Jump to box and press enter</li></ol> <p>x0400 is the first line of the GETC TRAP routine</p></div> <div class="question-mc" data-v-133aabb1><table class="questionTable" style="width: 100%" data-v-133aabb1><tr data-v-133aabb1><p class="header" data-v-133aabb1><b data-v-133aabb1>Quick Question:</b> Choose One</p> <p class="question" data-v-133aabb1>What register(s) are save at the start of GETC at x0400?</p></tr> <tr data-v-133aabb1><td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="A" id="A" data-v-133aabb1>
          None
          <span class="checkmark" data-v-133aabb1></span></label></td> <td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="B" id="B" data-v-133aabb1>
          R7
          <span class="checkmark" data-v-133aabb1></span></label></td></tr> <tr data-v-133aabb1><td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="C" id="C" data-v-133aabb1>
          R7 and R0
          <span class="checkmark" data-v-133aabb1></span></label></td> <td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="D" id="D" data-v-133aabb1>
          R0
          <span class="checkmark" data-v-133aabb1></span></label></td></tr> <!----> <!----></table></div> <div class="question-mc" data-v-133aabb1><table class="questionTable" style="width: 100%" data-v-133aabb1><tr data-v-133aabb1><p class="header" data-v-133aabb1><b data-v-133aabb1>Quick Question:</b> Choose One</p> <p class="question" data-v-133aabb1>What is the last action GETC performs before the RET line at x0404?</p></tr> <tr data-v-133aabb1><td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="A" id="A" data-v-133aabb1>
          Converts the character to ASCII
          <span class="checkmark" data-v-133aabb1></span></label></td> <td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="B" id="B" data-v-133aabb1>
          Displays the charater
          <span class="checkmark" data-v-133aabb1></span></label></td></tr> <tr data-v-133aabb1><td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="C" id="C" data-v-133aabb1>
          Loads R7 into x0408
          <span class="checkmark" data-v-133aabb1></span></label></td> <td data-v-133aabb1><label class="PossibleAnswers" data-v-133aabb1><input type="radio" name="radio" value="D" id="D" data-v-133aabb1>
          Restores R7
          <span class="checkmark" data-v-133aabb1></span></label></td></tr> <!----> <!----></table></div> <div class="question-tf" data-v-7d67ab80><table class="questionTable" style="width: 100%" data-v-7d67ab80><tr data-v-7d67ab80><p class="header" data-v-7d67ab80><b data-v-7d67ab80>Quick Question:</b> True/False</p> <p class="question" data-v-7d67ab80>The 2 TRAP instructions that appear at x0406 and x0407 are real TRAP instruction calls</p></tr><tr data-v-7d67ab80><td data-v-7d67ab80><label class="PossibleAnswers" data-v-7d67ab80>
            True
            <input type="radio" name="radio" value="True" id="t" data-v-7d67ab80> <span class="checkmark" data-v-7d67ab80></span></label></td> <td data-v-7d67ab80><label class="PossibleAnswers" data-v-7d67ab80>
            False
            <input type="radio" name="radio" value="False" id="f" data-v-7d67ab80> <span class="checkmark" data-v-7d67ab80></span></label></td></tr> <!----> <!----></table></div> <div class="custom-block tip"><p class="custom-block-title">TRAP Routines in other Instruction Architecture Sets</p> <p>TRAP routines are ISA-defined. Each ISA may provide routines to support the intended/expected use of the ISA. An ISA designed for communication might include TRAP functions to connect to external systems and support basic I/O functions</p></div> <h2 id="trap-vector-table"><a href="#trap-vector-table" class="header-anchor">#</a> Trap Vector Table</h2> <p>The LC-3 reserves memory addresses x0000 - x00FF for TRAP routine lookup. The TRAP Vector Table only contains references in memory locations x0020 - x0025 for the existing 6 routines. Each address in this jump table contains the location, in memory, of the start of a given TRAP function code block</p> <div class="custom-block tip"><p class="custom-block-title">Vector Table Location</p> <p>LC-3 allocated memory location x0000 - x00FF for Trap Vector entries. This sets aside 256 memory location for addresses to TRAP routines. However, LC-3 only provides 6 TRAP routines, so much of the Vector Table is empty</p></div> <div class="question-tf" data-v-7d67ab80><table class="questionTable" style="width: 100%" data-v-7d67ab80><tr data-v-7d67ab80><p class="header" data-v-7d67ab80><b data-v-7d67ab80>Quick Question:</b> True/False</p> <p class="question" data-v-7d67ab80>If the LC-3 creators wanted to move PUTS from x0450 to x0460, they would only need to change the LC-3 Trap Vector Table's Vector for PUTS?</p></tr><tr data-v-7d67ab80><td data-v-7d67ab80><label class="PossibleAnswers" data-v-7d67ab80>
            True
            <input type="radio" name="radio" value="True" id="t" data-v-7d67ab80> <span class="checkmark" data-v-7d67ab80></span></label></td> <td data-v-7d67ab80><label class="PossibleAnswers" data-v-7d67ab80>
            False
            <input type="radio" name="radio" value="False" id="f" data-v-7d67ab80> <span class="checkmark" data-v-7d67ab80></span></label></td></tr> <!----> <!----></table></div> <div class="custom-block tip"><p class="custom-block-title">How the LC-3 Executes a TRAP PUTS instruction</p> <p>During the execution the <code>TRAP PUTS</code> instruction, the LC-3 controller 'knows' the PUTS vector entry in the table is memory location x0022. The controller requested the contents of memory location x0022, and receives the address x0450</p> <p>The controller stores the current PC (instruciton after the <code>TRAP PUTS</code> instruction) in R7, and changes the PC to x0450. It then ends the instruction cycle</p> <p>The next instruction cycle starts with the PC x0450, and the first line of the PUTS instruction begines a new instruction cycle</p></div> <p>Things to note:</p> <ul><li>The Jump Table address (x0022) for PUTS contains the address (x0450) of the first line of code for the <code>PUTS TRAP</code> function</li> <li>Before the PC is changed to x0450, the LC-3 controller stashed the current PC in R7
<ul><li>Remember that R7 is used by <code>RET</code> to return back to the</li></ul></li></ul> <h3 id="the-puts-function"><a href="#the-puts-function" class="header-anchor">#</a> The PUTS Function</h3> <div class="language- extra-class"><pre class="language-text"><code>.ORIG x0450
	;;; Save Registers ;;;
SavRegs	ST R7, R7_Store ; Return Address
		ST R0, R0_Store ; Pointer to String to Puts
		ST R1, R1_Store
		ST R2, R2_Store

Loop	LDR R1, R0, #0; Get address of first char of string
		BRz Done ;	Char was 0, so we are done

Wait	LDI R2, DSR ;	Console available?
		BRzp Wait 	;	No, loop back and try again

		STI R1, DDR ;	Write char to console

		ADD R0, R0, #1;	Move pointer to next char in String
		BRnzp Loop ;	Loop back for next caracter

	;;; Restore Registers ;;;
Done	LD R0, R0_Store
		LD R1, R1_Store
		LD R2, R2_Store
		LD R7, R7_Store

		RET

;Data Declarations-------------
	DSR		.FILL xFE04
	DDR		.FILL xFE06
	MX0462		.FILL xF3FD
	MX0463		.FILL xF3FE
	R0_Store	.FILL #0
	R1_Store	.FILL #0
	R2_Store	.FILL #0
	R7_Store	.FILL #0
.END
</code></pre></div><p>Things to note:</p> <ol><li>PUTS first stores the current contents of R7, R0, R1, R2 in memory
<ul><li>R7 contains the location of the calling code's next instruction</li> <li>R0 was set in the calling code just before calling PUTS. It contains the address of the first character to be output by PUTS
<ul><li>PUTS stores R0 at the start because it will change R0 as it prints each character</li> <li>The calling code may expect R0 to be set like it was before it called PUTS</li></ul></li> <li>R1 and R2 are used in the execution of PUTS. Because PUTS has no way of knowing if the calling code was using these registers, it stores them to be safe</li></ul></li> <li>Next PUTS gets the first character, stored in R0 by the calling code
<ul><li>At any time R0 contains zero (0), PUTS will exit this loop as all characters have been written to the console</li> <li>a value zero (0) is a special case to PUTS. It is the end-of-string marker</li></ul></li> <li>Expecting that R0 does not contain zero (0), PUTS waits for the console to be ready, then copies the value in R0 (an ascii number representing the character to display) to the Display Data Register</li> <li>R0 is incremented to point to the next character in the string to display</li> <li>PUTS unconditionally loop back to check for zero (0), and start the cycle again</li> <li>Once R0 is loaded with zero (0), PUTS is done displaying characters
<ul><li>R7, R0, R1, and R2 original values are copied from memory back to each register</li></ul></li> <li>RET is called, and the PC is loaded with the value n R7 (the calling code's next instruction)</li> <li>Execution continues ate the calling code's next instruction after PUTS was called</li></ol> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>TRAP Routines are defined by an ISA</p> <p>Designers and implementers of an ISA write TRAP code and provide information in the ISA's Application Programming Iinterface (API) to help assembly programs find and use these utilities</p> <p>LC-3 designers provide 6 TRAP routines</p> <p>LC-3 TRAP routines can be called using the <code>TRAP</code> instruction</p> <p>LC-3 Assembler can also identify special shorcut names for TRAP routines, to make code more understandable</p> <p>Like subroutines, TRAP routines save registers when they start and restore them when complete</p> <blockquote><p>If they did not save registers they use, the registers would be in an unpredictable state when a TRAP returns back to your program...making it virtually unusable</p></blockquote> <p>Also, like subroutines, <code>TRAP</code> routines use <code>RET</code> to return control back to the program that</p> <p>TRAP routines may require particular register be set before calling -or- set during execution for the user program to examine after the TRAP completes</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/LC3/Commands/MemoryAccess.html" class="prev">
        LC3 Memory Access Commands
      </a></span> <span class="next"><a href="/LC3/Commands/Subroutine.html">
        LC3 Subroutine Commands
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.55f9c1c1.js" defer></script><script src="/assets/js/2.23fe0875.js" defer></script><script src="/assets/js/61.9b586efb.js" defer></script><script src="/assets/js/5.f5b36fc3.js" defer></script><script src="/assets/js/3.799b0ae7.js" defer></script><script src="/assets/js/6.316a9004.js" defer></script><script src="/assets/js/7.9b806e34.js" defer></script>
  </body>
</html>
